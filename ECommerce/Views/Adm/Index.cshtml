
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/css/login/Style.css" rel="stylesheet" />
@*<link href="https://cdnjs.cloudflare.com/ajax/libs/icheck-bootstrap/3.0.1/icheck-bootstrap.min.css" rel="stylesheet">*@
<br />
<br />
<br />
<br />
<style>
    button.btn2 {
        width: 100%;
        height: 50px;
        margin: 0;
        padding: 0 20px;
        vertical-align: middle;
        background: #15436d;
        background: linear-gradient(to right, #ffffff, #ffffff);
        border: 0;
        font-family: 'Roboto', sans-serif;
        font-size: 16px;
        font-weight: 500;
        line-height: 50px;
        color: #4391cf;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 4px;
        text-shadow: none;
        -moz-box-shadow: none;
        -webkit-box-shadow: none;
        box-shadow: none;
        -o-transition: all .3s;
        -moz-transition: all .3s;
        -webkit-transition: all .3s;
        -ms-transition: all .3s;
        transition: all .3s;
    }

        button.btn2:hover {
            opacity: 0.9;
            color: #005ea9;
        }

    .form-check-label {
        padding-left: 1.25rem;
        margin-bottom: 0;
        color: #ffff;
    }

    .form-top {
        overflow: hidden;
        padding: 0 25px 15px 25px;
        background: #9E9E9E;
        background: -webkit-linear-gradient(to right, #3a7bd5, #00d2ff);
        background: linear-gradient(to right, #77a4b5, #b1cc69);
        -moz-border-radius: 4px 4px 0 0;
        -webkit-border-radius: 4px 4px 0 0;
        border-radius: 4px 4px 0 0;
        text-align: left;
    }

    button.btn {
        width: 100%;
        height: 50px;
        margin: 0;
        padding: 0 20px;
        vertical-align: middle;
        background: #15436d;
        background: linear-gradient(to right, #78a4b8, #b0ce68);
        border: 0;
        font-family: 'Roboto', sans-serif;
        font-size: 16px;
        font-weight: 300;
        line-height: 50px;
        color: #fff;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 4px;
        text-shadow: none;
        -moz-box-shadow: none;
        -webkit-box-shadow: none;
        box-shadow: none;
        -o-transition: all .3s;
        -moz-transition: all .3s;
        -webkit-transition: all .3s;
        -ms-transition: all .3s;
        transition: all .3s;
    }

    .icon-header-noti::after {
        content: attr(data-notify);
        font-family: "Proxima Nova",-apple-system,"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
        font-size: 12px;
        color: #fff;
        line-height: 15px;
        text-align: center;
        display: block;
        position: absolute;
        top: -7px;
        right: 0;
        min-width: 15px;
        height: 15px;
        padding: 0 3px;
        background-color: #b1cc69;
    }

    button.btn:focus {
        outline: 0;
        opacity: 0.6;
        background: #add066;
        color: #fff;
    }

</style>
<!-- Top content -->
<div class="top-content">

    <div class="inner-bg">
        <div class="container">
            <div class="row">
                <div class="col-sm-8 col-sm-offset-2 text">
                    <h1><strong>Bienvenido</strong> </h1>
                    <div class="description">
                        <p>
                            Crea una cuenta con nosotros, para realizar <strong> rastreos sobre tus compras realizadas</strong>.
                            <br />
                            Al inciar sesión estás aceptando los <a href="#"><strong>Términos y condiciones de Uso </strong></a>
                            <br />
                        </p>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 book">
                    <img src="~/images/icons/logoCSB.png" class="img-fluid" />
                </div>
                <div class="col-sm-6 form-box">
                    <div class="form-top">
                        <div class="form-top-left">
                            <h3>Iniciar sesión </h3>
                            <br />
                            <p>Complete el siguiente formulario para obtener acceso:</p>
                        </div>
                        <div class="form-top-right">
                            <i class="fa fa-user-circle-o" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div class="form-bottom">
                        <form role="form" action="">
                            <div class="row">
                                <div class="form-group col-sm-12">
                                    <label class="sr-only" for="form-email">Email</label>
                                    <input type="text" name="form-email" onKeyUp="CorreofrM('EmailLogin')" placeholder="Email ..." class="form-email form-control" id="EmailLogin">
                                </div>

                                <div class="form-group col-sm-12">
                                    <label class="sr-only" for="form-last-name">Contraseña</label>
                                    <input type="password" name="Password" placeholder="Password ..." class="form-last-name form-control" id="Password" style="height: 40px;">
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-check col-sm-1">
                                </div>
                                <div class="form-check col-sm-11">
                                    <input type="checkbox" class="form-check-input" id="SesionCheck" name="SesionCheck">
                                    <label class="form-check-label" for="SesionCheck">
                                        Recordar contraseña
                                    </label>
                                </div>
                            </div>
                            
                            <div id='alertBoxes'></div><span class='timer' id='timer'></span>
                            <br />
                            <button type="button" id="BtnRegistrar" class="btn">Iniciar sesión</button>
                            <br /><br />
                            <p style="color: #fff; text-align: center">¿ Eres nuevo y en Asae E-Commerce ?</p>
                            <br />
                            <button type="button" id="CrearCuenta" class="btn2" onclick="#!">Crea tu cuenta</button>
                            @*<p style="color:#fff; text-align:center">
                                <br />
                                No tengo cuenta,  <a href="@Url.Action("Registrar", "Adm")"><strong>registrar </strong></a>
                                <br />
                            </p>*@

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<br />
<br />
<br />
<div class="bg6 flex-c-m flex-w size-302 " style=" background: linear-gradient(to right, #78a4b8, #b0ce68);">
    <span class="stext-107 cl6 p-lr-25">
    </span>
    <span class="stext-107 cl6 p-lr-25">
    </span>
</div>

<script src="~/vendor/jquery/jquery-3.2.1.min.js"></script>
<script src="~/assets/js/bootstrap-notify/bootstrap-notify.min.js"></script>


<script>
    $(document).ready(function () {
        var timeSlide = 500;
        $('#timer').hide(0);
        $('#timer').css('display', 'none');
        $('#BtnRegistrar').click(function () {
            $('.box-success,.box-error').slideUp(timeSlide);
            setTimeout(function () {
                if (validaLogin()) {
                    if (CorreoLogin() == "ok") {
                        $('#timer').fadeOut(300);
                        $('#alertBoxes').html('<div class="box-error"></div>');
                        $('.box-error').hide(0).html("Enviado <img src='/images/icons/ajax-loader.gif' width='20px' height='20px'/>");
                        $('.box-error').slideDown(timeSlide);

                        var Session = false;
                       

                        if ($('input:checkbox[name=SesionCheck]:checked').val()) {
                            Session = true;
                        }

                        var obj = {};

                        obj['Email'] = $('#EmailLogin').val();;
                        obj['Password'] = $('#Password').val();
                        obj['Ruta'] = '@ViewBag.rd';
                        obj['RutaAcceso'] = '@ViewBag.rdv';
                        obj['Session'] = Session;

                        var jsonObject = {
                            "Usuarios": obj
                        };

                        $.ajax({
                            url: "@Url.Action("Iniciar", "Adm")",
                            type: "POST",
                            data: JSON.stringify(jsonObject),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            error: function (response) {
                                $('#timer').fadeOut(300);
                                $('#alertBoxes').html('<div class="box-error"></div>');
                                $('.box-error').hide(0).html('');
                                $('.box-error').slideDown(timeSlide);

                                swal({
                                    title: "Algo ocurrió !",
                                    text: "Ha ocurrido un problema, inténtalo mas tarde ",
                                    icon: "warning",
                                    button: "Aceptar",
                                });
                            },
                            success: function (response) {
                                $('#timer').fadeOut(300);
                                $('#alertBoxes').html('<div class="box-error"></div>');
                                $('.box-error').hide(0).html('');
                                $('.box-error').slideDown(timeSlide);

                                switch (response.IdRol) {
                                    case -1:
                                        swal({
                                            title: "¡Tu usuario un no está activado! ",
                                            text: "Se envió un correo a  " + $('#EmailLogin').val() + "  para activar tu usuario. \n\n ¿Deseas que volvamos a mandar un correo de confirmación de usuario?. \n\n Si no recibes el correo electrónico de verificación, \n\n  es posible que se encuentre en la carpeta Spam o correo no deseado.",
                                            icon: "warning",
                                            buttons: true,
                                            dangerMode: true,
                                            buttons: ["Cancelar", "Enviar correo"],
                                        })
                                        .then((willDelete) => {
                                            if (willDelete) {
                                                alert('metodo de envio de correo');
                                            }
                                        });
                                        break;
                                    case 0:
                                        swal({
                                            title: "Algo ocurrió !",
                                            text: response.Mensaje,
                                            icon: "warning",
                                            button: "Aceptar",
                                        });

                                        break;
                                    case 1:
                                        swal({
                                            title: "Bienvenido. !",
                                            text: response.Nombre + " " + response.Apellidos,
                                            icon: "success",
                                            button: "Aceptar",
                                        }) .then((value) => {
                                            window.location.href = '' + response.RutaAcceso + '';
                                                
                                        });
                                        break;
                                    case 2:
                                        swal({
                                            title: "Bienvenido. !",
                                            text: response.Nombre + " " + response.Apellidos,
                                            icon: "success",
                                            button: "Aceptar",
                                        }).then((value) => {
                                            window.location.href = '' + response.RutaAcceso + '';

                                        });
                                        break;
                                    default:
                                    // code block

                                }
                            }
                        });


                    } else {
                        $('#timer').fadeOut(300);
                        $('#alertBoxes').html('<div class="box-error"></div>');
                        $('.box-error').hide(0).html('Coloca tu email correctamente.');
                        $('.box-error').slideDown(timeSlide);

                        $.notify({
                            icon: 'fa fa-paw',
                            message: "Coloca tu email correctamente."
                        }, {
                            type: 'danger',
                            allow_dismiss: false,
                            animate: {
                                enter: 'animated rollIn',
                                exit: 'animated rollOut'
                            }
                        });
                    }
                }
                else {

                    $('#timer').fadeOut(300);
                    $('#alertBoxes').html('<div class="box-error"></div>');
                    $('.box-error').hide(0).html('Formulario incompleto .');
                    $('.box-error').slideDown(timeSlide);

                    $.notify({
	                icon: 'fa fa-paw',
	                message: "Formulario incompleto ."
                    },{
                            type: 'danger',
                        allow_dismiss: false,
                        animate: {
		                    enter: 'animated rollIn',
		                    exit: 'animated rollOut'
	                    }
                    });
                }


            }, timeSlide);
            return false;
        });
    });

    function validaLogin() {
        var respuesta = false;

        $('#EmailLogin').css("border", "2px solid #f44336");
        $('#Password').css("border", "2px solid #f44336");

        if ($('#EmailLogin').val().length > 0) {
            $('#EmailLogin').css("border", "1px solid #64C0FF");
        }
        if ($('#Password').val().length > 0) {
            $('#Password').css("border", "1px solid #64C0FF");
        }

        if ($('#EmailLogin').val().length > 0) {
            if ($('#Password').val().length > 0) {
                respuesta = true;
            }
        }

        //var respuesta = "";
        //$('#EmailLogin').css("border", "1px solid #64C0FF");
        //$('#Password').css("border", "1px solid #64C0FF");

        //if ($('#EmailLogin').val().length > 0) {
        //    if ($('#Password').val().length > 0) {
        //        if (CorreoLogin() == "ok") {
        //                respuesta = "ok";
        //        }else{
        //            $('#EmailLogin').css("border", "1px solid red");
        //            respuesta = "Coloca tu email correctamente";
        //        }
        //    }
        //    else {
        //        $('#Password').css("border", "1px solid red");
        //        respuesta = "Coloca tu password";
        //    }
        //} else {
        //    $('#EmailLogin').css("border", "1px solid red");
        //    respuesta = "Coloca tu email";
        //}
        return respuesta;
    }
</script>